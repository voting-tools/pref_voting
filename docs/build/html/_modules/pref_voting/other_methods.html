<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <!-- Generated with Sphinx 6.2.1 and Furo 2023.03.27 -->
        <title>pref_voting.other_methods - Preferential Voting Tools</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Preferential Voting Tools</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-scroll"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">Preferential Voting Tools</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Elections</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../edata_overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../profiles.html">Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../profiles_with_ties.html">Profiles with Ties</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../margin_graphs.html">(Weighted) Majority Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generate_profiles.html">Generate Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generate_weighted_majority_graphs.html">Generate Weighted Majority Graphs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Voting Methods</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../vms_overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scoring_methods.html">Positional Scoring Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iterative_methods.html">Iterative Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c1_methods.html">C1 Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../margin_based_methods.html">Margin Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../combined_methods.html">Combined Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other_methods.html">Other Methods</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Axioms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../axioms_overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dominance_axioms.html">Dominance Axioms</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../analysis_overview.html">Overview</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for pref_voting.other_methods</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    File: mg_methods.py</span>
<span class="sd">    Author: Eric Pacuit (epacuit@umd.edu)</span>
<span class="sd">    Date: January 12, 2022</span>
<span class="sd">    </span>
<span class="sd">    Implementations of </span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">pref_voting.voting_method</span> <span class="kn">import</span>  <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pref_voting.profiles</span> <span class="kn">import</span> <span class="n">_find_updated_profile</span><span class="p">,</span> <span class="n">_num_rank</span>
<span class="kn">from</span> <span class="nn">pref_voting.helper</span> <span class="kn">import</span> <span class="n">get_mg</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span><span class="p">,</span> <span class="n">permutations</span><span class="p">,</span> <span class="n">chain</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>


<div class="viewcode-block" id="majority"><a class="viewcode-back" href="../../other_methods.html#pref_voting.other_methods.majority">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Majority&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">majority</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The majority winner is the candidate with a strict majority  of first place votes.  Returns an empty list if there is no candidate with a strict majority of first place votes. Returns the majority winner in the ``profile`` restricted to ``curr_cands``.</span>

<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">    .. important:: </span>
<span class="sd">        Formally, this is *not* a voting method since the function might return an empty list (when there is no candidate with a strict majority of first place votes).  Also, if there is a majority winner, then that winner is unique. </span>

<span class="sd">    :Example:</span>
<span class="sd">        .. exec_code::</span>

<span class="sd">            from pref_voting.profiles import Profile</span>
<span class="sd">            from pref_voting.other_methods import majority</span>
<span class="sd">            </span>
<span class="sd">            prof1 = Profile([[0, 1, 2], [1, 0, 2], [2, 1, 0]], [3, 1, 2])</span>
<span class="sd">            prof1.display()</span>
<span class="sd">            majority.display(prof1)</span>

<span class="sd">            prof2 = Profile([[0, 1, 2], [1, 0, 2], [1, 2, 0]], [5, 1, 2])</span>
<span class="sd">            prof2.display()</span>
<span class="sd">            majority.display(prof2)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">maj_size</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">strict_maj_size</span><span class="p">()</span>
    <span class="n">curr_cands</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>

    <span class="n">plurality_scores</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">plurality_scores</span><span class="p">(</span><span class="n">curr_cands</span> <span class="o">=</span> <span class="n">curr_cands</span><span class="p">)</span>
    <span class="n">maj_winner</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">curr_cands</span> <span class="k">if</span> <span class="n">plurality_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">maj_size</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">maj_winner</span><span class="p">)</span></div>

    
<span class="c1">## Banks</span>
<span class="c1">#</span>

<span class="k">def</span> <span class="nf">seqs</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">permutations</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">is_transitive</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">c1_idx</span><span class="p">,</span> <span class="n">c1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">c2</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="n">c1_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">::]:</span>            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">G</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="k">def</span> <span class="nf">is_subsequence</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">ch</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">it</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>

<div class="viewcode-block" id="banks"><a class="viewcode-back" href="../../other_methods.html#pref_voting.other_methods.banks">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Banks&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">banks</span><span class="p">(</span><span class="n">edata</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Say that a *chain* in majority graph is a subset of candidates that is linearly ordered by the majority relation. Then a candidate :math:`a` if :math:`a` is the maximum element with respect to the majority relation of some maximal chain in the majority graph.</span>

<span class="sd">    Args:</span>
<span class="sd">        edata (Profile, ProfileWithTies, MarginGraph): Any election data that has a `margin` method. </span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>


<span class="sd">    :Example: </span>

<span class="sd">    .. plot::  margin_graphs_examples/mg_ex_banks.py</span>
<span class="sd">        :context: reset  </span>
<span class="sd">        :include-source: True</span>


<span class="sd">    .. code-block:: </span>

<span class="sd">        from pref_voting.other_methods import banks</span>

<span class="sd">        banks.display(prof)</span>


<span class="sd">    .. exec_code:: </span>
<span class="sd">        :hide_code:</span>

<span class="sd">        from pref_voting.weighted_majority_graphs import MarginGraph</span>
<span class="sd">        from pref_voting.other_methods import banks</span>
<span class="sd">        </span>
<span class="sd">        mg = MarginGraph([0, 1, 2, 3], [(0, 2, 2), (0, 3, 6), (1, 0, 8), (2, 3, 4), (2, 1, 10), (3, 1, 12)])</span>

<span class="sd">        banks.display(mg)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mg</span> <span class="o">=</span> <span class="n">get_mg</span><span class="p">(</span><span class="n">edata</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="n">curr_cands</span><span class="p">)</span>
    <span class="n">trans_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">seqs</span><span class="p">(</span><span class="n">mg</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nx</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">simple_paths</span><span class="o">.</span><span class="n">is_simple_path</span><span class="p">(</span><span class="n">mg</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">is_transitive</span><span class="p">(</span><span class="n">mg</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span> 
                <span class="n">trans_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="n">maximal_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="c1">#print(&quot;max paths&quot;)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">trans_paths</span><span class="p">:</span>
        <span class="n">is_max</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">other_s</span> <span class="ow">in</span> <span class="n">trans_paths</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="n">other_s</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_subsequence</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">other_s</span><span class="p">):</span> 
                    <span class="n">is_max</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="n">is_max</span><span class="p">:</span>
            <span class="n">maximal_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">maximal_paths</span><span class="p">])))</span></div>

<div class="viewcode-block" id="banks_with_explanation"><a class="viewcode-back" href="../../other_methods.html#pref_voting.other_methods.banks_with_explanation">[docs]</a><span class="k">def</span> <span class="nf">banks_with_explanation</span><span class="p">(</span><span class="n">edata</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the Banks winners and the list of maximal chains in the majority graph. </span>

<span class="sd">    Args:</span>
<span class="sd">        edata (Profile, ProfileWithTies, MarginGraph): Any election data that has a `margin` method. </span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">        A list of lists of candidates each representing a maximal chain in the majority graph</span>

<span class="sd">    :Example: </span>

<span class="sd">    .. plot::  margin_graphs_examples/mg_ex_banks.py</span>
<span class="sd">        :context: reset  </span>
<span class="sd">        :include-source: True</span>


<span class="sd">    .. code-block:: </span>

<span class="sd">        from pref_voting.other_methods import banks_with_explanation</span>

<span class="sd">        bws, maximal_chains = banks_with_explanation(mg)</span>

<span class="sd">        print(f&quot;Winning set: {bws}&quot;)</span>
<span class="sd">        for c in maximal_chains: </span>
<span class="sd">            print(f&quot;Maximal chain: {c}&quot;)</span>


<span class="sd">    .. exec_code:: </span>
<span class="sd">        :hide_code:</span>

<span class="sd">        from pref_voting.weighted_majority_graphs import MarginGraph</span>
<span class="sd">        from pref_voting.other_methods import banks_with_explanation</span>
<span class="sd">        </span>
<span class="sd">        mg = MarginGraph([0, 1, 2, 3], [(0, 2, 2), (0, 3, 6), (1, 0, 8), (2, 3, 4), (2, 1, 10), (3, 1, 12)])</span>

<span class="sd">        bws, maximal_chains = banks_with_explanation(mg)</span>

<span class="sd">        print(f&quot;Winning set: {bws}&quot;)</span>
<span class="sd">        for c in maximal_chains: </span>
<span class="sd">            print(f&quot;Maximal chain: {c}&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mg</span> <span class="o">=</span> <span class="n">get_mg</span><span class="p">(</span><span class="n">edata</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="n">curr_cands</span><span class="p">)</span>
    <span class="n">trans_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">seqs</span><span class="p">(</span><span class="n">mg</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nx</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">simple_paths</span><span class="o">.</span><span class="n">is_simple_path</span><span class="p">(</span><span class="n">mg</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">is_transitive</span><span class="p">(</span><span class="n">mg</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span> 
                <span class="n">trans_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="n">maximal_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="c1">#print(&quot;max paths&quot;)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">trans_paths</span><span class="p">:</span>
        <span class="n">is_max</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">other_s</span> <span class="ow">in</span> <span class="n">trans_paths</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="n">other_s</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_subsequence</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">other_s</span><span class="p">):</span> 
                    <span class="n">is_max</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="n">is_max</span><span class="p">:</span>
            <span class="n">maximal_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">maximal_paths</span><span class="p">]))),</span> <span class="n">maximal_paths</span></div>

<span class="c1">## Slater</span>
<span class="c1">#</span>

<span class="k">def</span> <span class="nf">distance_to_margin_graph</span><span class="p">(</span><span class="n">edata</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">exp</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the distance of ``rel`` (a relation) to the majority graph of ``edata``. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">edata</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    
    <span class="n">penalty</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> 
        <span class="k">if</span> <span class="n">edata</span><span class="o">.</span><span class="n">majority_prefers</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rel</span><span class="p">:</span> 
            <span class="n">penalty</span> <span class="o">+=</span> <span class="p">(</span><span class="n">edata</span><span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">edata</span><span class="o">.</span><span class="n">majority_prefers</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rel</span><span class="p">:</span> 
            <span class="n">penalty</span> <span class="o">+=</span> <span class="p">(</span><span class="n">edata</span><span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">**</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">edata</span><span class="o">.</span><span class="n">majority_prefers</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rel</span> <span class="ow">and</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rel</span><span class="p">:</span> 
            <span class="n">penalty</span> <span class="o">+=</span> <span class="p">(</span><span class="n">edata</span><span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="n">exp</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> 
        <span class="k">elif</span> <span class="n">edata</span><span class="o">.</span><span class="n">majority_prefers</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rel</span> <span class="ow">and</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rel</span><span class="p">:</span> 
            <span class="n">penalty</span> <span class="o">+=</span> <span class="p">(</span><span class="n">edata</span><span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">**</span> <span class="n">exp</span><span class="p">)</span>  <span class="o">/</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">penalty</span>


<span class="k">def</span> <span class="nf">lin_order_to_rel</span><span class="p">(</span><span class="n">lin_order</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a linear order (a list of items) into a set of ordered pairs&quot;&quot;&quot;</span>
    <span class="n">els</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lin_order</span><span class="p">)</span>
    <span class="n">rel</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">els</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lin_order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">lin_order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">):</span> 
            <span class="n">rel</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">lin_order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">lin_order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a</span><span class="p">):</span> 
            <span class="n">rel</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">))</span>     
    <span class="k">return</span> <span class="n">rel</span>


<div class="viewcode-block" id="slater_rankings"><a class="viewcode-back" href="../../other_methods.html#pref_voting.other_methods.slater_rankings">[docs]</a><span class="k">def</span> <span class="nf">slater_rankings</span><span class="p">(</span><span class="n">edata</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Slater ranking is a linear order :math:`R` of the candidates that minimizes the number of edges in the majority graph we have to turn around before we obtain :math:`R`. </span>

<span class="sd">    Args:</span>
<span class="sd">        edata (Profile, ProfileWithTies, MarginGraph): Any election data that has a `margin` method. </span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        rankings: A list of Slater rankings.</span>

<span class="sd">        dist: The minimum distance of the Slater rankings.</span>

<span class="sd">    :Example:</span>

<span class="sd">    .. exec_code::</span>

<span class="sd">        from pref_voting.weighted_majority_graphs import MarginGraph</span>
<span class="sd">        from pref_voting.other_methods import slater_rankings</span>
<span class="sd">        </span>
<span class="sd">        mg = MarginGraph([0, 1, 2, 3], [(0, 2, 2), (0, 3, 6), (1, 0, 8), (2, 3, 4), (2, 1, 10), (3, 1, 12)])</span>

<span class="sd">        srs, d = slater_rankings(mg)</span>
<span class="sd">        print(f&quot;minimum distance: {d}&quot;)</span>
<span class="sd">        for sr in srs: </span>
<span class="sd">            print(f&quot;ranking: {sr}&quot;) </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">edata</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    <span class="n">min_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="n">rankings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">lin_order</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="n">candidates</span><span class="p">):</span> 
        <span class="n">lo_rel</span> <span class="o">=</span> <span class="n">lin_order_to_rel</span><span class="p">(</span><span class="n">lin_order</span><span class="p">)</span>
        
        <span class="n">dist</span> <span class="o">=</span> <span class="n">distance_to_margin_graph</span><span class="p">(</span><span class="n">edata</span><span class="p">,</span> <span class="n">lo_rel</span><span class="p">,</span> <span class="n">exp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="n">curr_cands</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">min_dist</span><span class="p">:</span> 
            <span class="n">min_dist</span> <span class="o">=</span> <span class="n">dist</span>
            <span class="n">rankings</span> <span class="o">=</span> <span class="p">[</span><span class="n">lin_order</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">dist</span> <span class="o">==</span> <span class="n">min_dist</span><span class="p">:</span> 
            <span class="n">rankings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lin_order</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rankings</span><span class="p">,</span> <span class="n">min_dist</span></div>

        
<div class="viewcode-block" id="slater"><a class="viewcode-back" href="../../other_methods.html#pref_voting.other_methods.slater">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Slater&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">slater</span><span class="p">(</span><span class="n">edata</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Slater ranking is a linear order :math:`R` of the candidates that minimizes the number of edges in the majority graph we have to turn around before we obtain :math:`R`.   A candidate is a Slater winner if the candidate is the top element of some Slater ranking.</span>

<span class="sd">    Args:</span>
<span class="sd">        edata (Profile, ProfileWithTies, MarginGraph): Any election data that has a `margin` method. </span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>


<span class="sd">    :Example: </span>

<span class="sd">    .. plot::  margin_graphs_examples/mg_ex_slater.py</span>
<span class="sd">        :context: reset  </span>
<span class="sd">        :include-source: True</span>


<span class="sd">    .. code-block:: </span>

<span class="sd">        from pref_voting.other_methods import slater</span>

<span class="sd">        slater.display(prof)</span>


<span class="sd">    .. exec_code:: </span>
<span class="sd">        :hide_code:</span>

<span class="sd">        from pref_voting.weighted_majority_graphs import MarginGraph</span>
<span class="sd">        from pref_voting.other_methods import slater</span>
<span class="sd">        </span>
<span class="sd">        mg = MarginGraph([0, 1, 2, 3], [(0, 2, 2), (0, 3, 6), (1, 0, 8), (2, 3, 4), (2, 1, 10), (3, 1, 12)])</span>

<span class="sd">        slater.display(mg)</span>

<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="n">rankings</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">slater_rankings</span><span class="p">(</span><span class="n">edata</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="n">curr_cands</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rankings</span><span class="p">])))</span></div>


<span class="c1">## Kemmeny-Young Method </span>
<span class="c1">#</span>
<span class="k">def</span> <span class="nf">kendalltau_dist</span><span class="p">(</span><span class="n">rank_a</span><span class="p">,</span> <span class="n">rank_b</span><span class="p">):</span>
    <span class="n">rank_a</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">rank_a</span><span class="p">)</span>
    <span class="n">rank_b</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">rank_b</span><span class="p">)</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rank_a</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">tau</span> <span class="o">+=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">rank_a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">rank_a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">j</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">rank_b</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">rank_b</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">j</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">tau</span>


<span class="k">def</span> <span class="nf">_kemmeny_young_rankings</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">candidates</span><span class="p">):</span> 
    
    <span class="n">rankings_dist</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ranking</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="n">candidates</span><span class="p">):</span> 
        <span class="n">rankings_dist</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ranking</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">kendalltau_dist</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">ranking</span><span class="p">)</span> 
        <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">))</span>
    <span class="n">min_dist</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">rankings_dist</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="n">lin_orders</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rankings_dist</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">rankings_dist</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">==</span> <span class="n">min_dist</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">lin_orders</span><span class="p">,</span> <span class="n">min_dist</span>

<div class="viewcode-block" id="kemmeny_young_rankings"><a class="viewcode-back" href="../../other_methods.html#pref_voting.other_methods.kemmeny_young_rankings">[docs]</a><span class="k">def</span> <span class="nf">kemmeny_young_rankings</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Kemmeny-Young ranking is a ranking that minimizes the sum of the Kendall tau distances to the voters&#39; rankings.  </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        rankings: A list of Slater rankings.</span>
<span class="sd">        </span>
<span class="sd">        dist: The minimum distance of the Slater rankings.</span>


<span class="sd">    :Example:</span>
<span class="sd">        .. exec_code::</span>

<span class="sd">            from pref_voting.profiles import Profile</span>
<span class="sd">            from pref_voting.other_methods import kemmeny_young, kemmeny_young_rankings</span>
<span class="sd">            </span>
<span class="sd">            prof1 = Profile([[0, 1, 2], [1, 0, 2], [2, 1, 0]], [3, 1, 2])</span>
<span class="sd">            prof1.display()</span>
<span class="sd">            kyrs, d = kemmeny_young_rankings(prof1)</span>
<span class="sd">            print(f&quot;Minimal distance: {d}&quot;)</span>
<span class="sd">            for kyr in kyrs: </span>
<span class="sd">                print(f&quot;ranking: {kyr}&quot;)</span>

<span class="sd">            prof2 = Profile([[0, 1, 2], [1, 0, 2], [1, 2, 0]], [5, 1, 2])</span>
<span class="sd">            prof2.display()</span>
<span class="sd">            kyrs, d = kemmeny_young_rankings(prof2)</span>
<span class="sd">            print(f&quot;Minimal distance: {d}&quot;)</span>
<span class="sd">            for kyr in kyrs: </span>
<span class="sd">                print(f&quot;ranking: {kyr}&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    
    <span class="n">rankings</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">]),</span>  <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_kemmeny_young_rankings</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rankings</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">_rcounts</span><span class="p">),</span> <span class="n">candidates</span><span class="p">)</span></div>


<div class="viewcode-block" id="kemmeny_young"><a class="viewcode-back" href="../../other_methods.html#pref_voting.other_methods.kemmeny_young">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Kemmeny-Young&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">kemmeny_young</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Kemmeny-Young ranking is a ranking that minimizes the sum of the Kendall tau distances to the voters&#39; rankings.  The Kemmeny-Young winners are the candidates that are ranked first by some Kemmeny-Young ranking.</span>

<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">    :Example:</span>

<span class="sd">        .. exec_code::</span>

<span class="sd">            from pref_voting.profiles import Profile</span>
<span class="sd">            from pref_voting.other_methods import kemmeny_young, kemmeny_young_rankings</span>
<span class="sd">            </span>
<span class="sd">            prof1 = Profile([[0, 1, 2], [1, 0, 2], [2, 1, 0]], [3, 1, 2])</span>
<span class="sd">            prof1.display()</span>
<span class="sd">            kyrs, d = kemmeny_young_rankings(prof1)</span>
<span class="sd">            print(f&quot;Minimal distance: {d}&quot;)</span>
<span class="sd">            for kyr in kyrs: </span>
<span class="sd">                print(f&quot;ranking: {kyr}&quot;)</span>
<span class="sd">            kemmeny_young.display(prof1)</span>

<span class="sd">            prof2 = Profile([[0, 1, 2], [1, 0, 2], [1, 2, 0]], [5, 1, 2])</span>
<span class="sd">            prof2.display()</span>
<span class="sd">            kyrs, d = kemmeny_young_rankings(prof2)</span>
<span class="sd">            print(f&quot;Minimal distance: {d}&quot;)</span>
<span class="sd">            for kyr in kyrs: </span>
<span class="sd">                print(f&quot;ranking: {kyr}&quot;)</span>
<span class="sd">            kemmeny_young.display(prof2)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    
    <span class="n">rankings</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">]),</span>  <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span><span class="p">)</span>
    <span class="n">ky_rankings</span><span class="p">,</span> <span class="n">min_dist</span> <span class="o">=</span> <span class="n">_kemmeny_young_rankings</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rankings</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">_rcounts</span><span class="p">),</span> <span class="n">candidates</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ky_rankings</span><span class="p">])))</span></div>

<span class="c1">### Bucklin</span>

<div class="viewcode-block" id="bucklin"><a class="viewcode-back" href="../../other_methods.html#pref_voting.other_methods.bucklin">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Bucklin&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bucklin</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If a candidate has a strict majority of first-place votes, then that candidate is the winner. If no such candidate exists, then check the candidates that are ranked first or second.  If a candidate has a strict majority of first- or second-place voters, then that candidate is the winner. If no such winner is found move on to the 3rd, 4th, etc. place votes.  Return the candidates with the greatest overall score.  </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.other_methods import bucklin</span>

<span class="sd">        prof = Profile([[1, 0, 2], [0, 2, 1], [0, 1, 2]], [2, 1, 1])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        bucklin.display(prof)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">strict_maj_size</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">strict_maj_size</span><span class="p">()</span>
    
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    
    <span class="n">num_cands</span> <span class="o">=</span> <span class="n">candidates</span>
    
    <span class="n">rankings</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">]),</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span><span class="p">)</span>

    <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rcounts</span>
    
    <span class="n">num_cands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
    <span class="n">ranks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_cands</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">cand_to_num_voters_rank</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ranks</span><span class="p">:</span>
        <span class="n">cand_to_num_voters_rank</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_num_rank</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
                                      <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>
        <span class="n">cand_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="nb">sum</span><span class="p">([</span><span class="n">cand_to_num_voters_rank</span><span class="p">[</span><span class="n">_r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">_r</span> <span class="ow">in</span> <span class="n">cand_to_num_voters_rank</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> 
                       <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">s</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">cand_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()]):</span>
            <span class="k">break</span>
    <span class="n">max_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cand_scores</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">cand_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">max_score</span><span class="p">])</span></div>


<div class="viewcode-block" id="bucklin_with_explanation"><a class="viewcode-back" href="../../other_methods.html#pref_voting.other_methods.bucklin_with_explanation">[docs]</a><span class="k">def</span> <span class="nf">bucklin_with_explanation</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the Bucklin winners and the score for each candidate. </span>
<span class="sd"> </span>
<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>

<span class="sd">        A sorted list of candidates</span>

<span class="sd">        A dictionary assigning the score for each candidate. </span>

<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.other_methods import bucklin_with_explanation</span>

<span class="sd">        prof = Profile([[1, 0, 2], [0, 2, 1], [0, 1, 2]], [2, 1, 1])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        sb_ws, scores = bucklin_with_explanation(prof)</span>

<span class="sd">        print(f&quot;The winners are {sb_ws}&quot;)</span>
<span class="sd">        print(f&quot;The candidate scores are {scores}&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">strict_maj_size</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">strict_maj_size</span><span class="p">()</span>
    
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    
    <span class="n">num_cands</span> <span class="o">=</span> <span class="n">candidates</span>
    
    <span class="n">rankings</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">]),</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span><span class="p">)</span>

    <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rcounts</span>
    
    <span class="n">num_cands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
    <span class="n">ranks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_cands</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">cand_to_num_voters_rank</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ranks</span><span class="p">:</span>
        <span class="n">cand_to_num_voters_rank</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_num_rank</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
                                      <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>
        <span class="n">cand_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="nb">sum</span><span class="p">([</span><span class="n">cand_to_num_voters_rank</span><span class="p">[</span><span class="n">_r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">_r</span> <span class="ow">in</span> <span class="n">cand_to_num_voters_rank</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> 
                       <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">s</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">cand_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()]):</span>
            <span class="k">break</span>
    <span class="n">max_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cand_scores</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">cand_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">max_score</span><span class="p">]),</span> <span class="n">cand_scores</span></div>



<div class="viewcode-block" id="simplified_bucklin"><a class="viewcode-back" href="../../other_methods.html#pref_voting.other_methods.simplified_bucklin">[docs]</a><span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Simplified Bucklin&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">simplified_bucklin</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If a candidate has a strict majority of first-place votes, then that candidate is the winner. If no such candidate exists, then check the candidates that are ranked first or second.  If a candidate has a strict majority of first- or second-place voters, then that candidate is the winner. If no such winner is found move on to the 3rd, 4th, etc. place votes. </span>

<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.other_methods import simplified_bucklin</span>

<span class="sd">        prof = Profile([[1, 0, 2], [0, 2, 1], [0, 1, 2]], [2, 1, 1])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        simplified_bucklin.display(prof)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">strict_maj_size</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">strict_maj_size</span><span class="p">()</span>
    
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    
    <span class="n">num_cands</span> <span class="o">=</span> <span class="n">candidates</span>
    
    <span class="n">rankings</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">]),</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span><span class="p">)</span>

    <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rcounts</span>
    
    <span class="n">num_cands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
    <span class="n">ranks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_cands</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">cand_to_num_voters_rank</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ranks</span><span class="p">:</span>
        <span class="n">cand_to_num_voters_rank</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_num_rank</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
                                      <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>
        <span class="n">cand_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="nb">sum</span><span class="p">([</span><span class="n">cand_to_num_voters_rank</span><span class="p">[</span><span class="n">_r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">_r</span> <span class="ow">in</span> <span class="n">cand_to_num_voters_rank</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> 
                       <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">s</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">cand_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()]):</span>
            <span class="k">break</span>
            
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">cand_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span><span class="p">])</span></div>

<div class="viewcode-block" id="simplified_bucklin_with_explanation"><a class="viewcode-back" href="../../other_methods.html#pref_voting.other_methods.simplified_bucklin_with_explanation">[docs]</a><span class="k">def</span> <span class="nf">simplified_bucklin_with_explanation</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the Simplified Bucklin winners and the score for each candidate. </span>
<span class="sd"> </span>
<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>

<span class="sd">    Returns: </span>

<span class="sd">        A sorted list of candidates</span>

<span class="sd">        A dictionary assigning the score for each candidate. </span>

<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.other_methods import simplified_bucklin_with_explanation</span>

<span class="sd">        prof = Profile([[1, 0, 2], [0, 2, 1], [0, 1, 2]], [2, 1, 1])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        sb_ws, scores = simplified_bucklin_with_explanation(prof)</span>

<span class="sd">        print(f&quot;The winners are {sb_ws}&quot;)</span>
<span class="sd">        print(f&quot;The candidate scores are {scores}&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">strict_maj_size</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">strict_maj_size</span><span class="p">()</span>
    
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    
    <span class="n">num_cands</span> <span class="o">=</span> <span class="n">candidates</span>
    
    <span class="n">rankings</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">]),</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span><span class="p">)</span>

    <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rcounts</span>
    
    <span class="n">num_cands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
    <span class="n">ranks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_cands</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">cand_to_num_voters_rank</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ranks</span><span class="p">:</span>
        <span class="n">cand_to_num_voters_rank</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_num_rank</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
                                      <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>
        <span class="n">cand_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="nb">sum</span><span class="p">([</span><span class="n">cand_to_num_voters_rank</span><span class="p">[</span><span class="n">_r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">_r</span> <span class="ow">in</span> <span class="n">cand_to_num_voters_rank</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> 
                       <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">s</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">cand_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()]):</span>
            <span class="k">break</span>
            
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">cand_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">strict_maj_size</span><span class="p">]),</span> <span class="n">cand_scores</span></div>


<span class="nd">@vm</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Weighted Bucklin&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">weighted_bucklin</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">curr_cands</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">strict_threshold</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">score</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">num_cands</span><span class="p">,</span> <span class="n">rank</span><span class="p">:</span> <span class="p">(</span><span class="n">num_cands</span> <span class="o">-</span> <span class="n">rank</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="n">num_cands</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">num_cands</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The Weighted Bucklin procedure, studied by D. Marc Kilgour, Jean-Charles Grgoire, and Angle Foley. The k-th Weighted Bucklin score of a candidate c is the sum for j \leq k of the product of score(num_cands,j) and the number of voters who rank c in j-th place. Compute higher-order Weighted Bucklin scores until reaching a k such that some candidate&#39;s k-th Weighted Bucklin score is at least half the number of voters (or the strict majority size if strict_threshold = True). Then return the candidates with maximal k-th Weighted Bucklin score. Bucklin is the special case where strict_threshold = True and score = lambda num_cands, rank: 1.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        profile (Profile): An anonymous profile of linear orders on a set of candidates</span>
<span class="sd">        curr_cands (List[int], optional): If set, then find the winners for the profile restricted to the candidates in ``curr_cands``</span>
<span class="sd">        strict_threshold: If True, makes the threshold for the Bucklin procedure the strict majority size; otherwise threshold is half the number of voters, following Kilgour et al.</span>
<span class="sd">        score (function): A function that accepts two parameters ``num_cands`` (the number of candidates) and ``rank`` (a rank of a candidate) used to calculate the score of a candidate. The default ``score`` function is the normalized version of the classic Borda score vector.</span>

<span class="sd">    Returns: </span>
<span class="sd">        A sorted list of candidates</span>

<span class="sd">    :Example: </span>

<span class="sd">    .. exec_code:: </span>

<span class="sd">        from pref_voting.profiles import Profile</span>
<span class="sd">        from pref_voting.other_methods import weighted_bucklin</span>

<span class="sd">        prof = Profile([[1, 0, 2], [0, 2, 1], [0, 1, 2]], [2, 1, 1])</span>

<span class="sd">        prof.display()</span>
<span class="sd">        weighted_bucklin.display(prof)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">strict_threshold</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">strict_maj_size</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_voters</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">candidates</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">curr_cands</span>
    
    <span class="n">num_cands</span> <span class="o">=</span> <span class="n">candidates</span>
    
    <span class="n">rankings</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span> <span class="k">if</span> <span class="n">curr_cands</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_find_updated_profile</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">_rankings</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">profile</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_cands</span><span class="p">]),</span> <span class="n">profile</span><span class="o">.</span><span class="n">num_cands</span><span class="p">)</span>

    <span class="n">rcounts</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">_rcounts</span>
    
    <span class="n">num_cands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
    <span class="n">ranks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_cands</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">cand_to_num_voters_rank</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ranks</span><span class="p">:</span>
        <span class="n">cand_to_num_voters_rank</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">_num_rank</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">rcounts</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
                                      <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>
        <span class="n">cand_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="nb">sum</span><span class="p">([</span><span class="n">score</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">),</span> <span class="n">_r</span><span class="p">)</span> <span class="o">*</span> <span class="n">cand_to_num_voters_rank</span><span class="p">[</span><span class="n">_r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">_r</span> <span class="ow">in</span> <span class="n">cand_to_num_voters_rank</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> 
                       <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">s</span> <span class="o">&gt;=</span> <span class="n">threshold</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">cand_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()]):</span>
            <span class="k">break</span>
    <span class="n">max_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cand_scores</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">cand_scores</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">max_score</span><span class="p">])</span>


<span class="n">other_vms</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">banks</span><span class="p">,</span>
    <span class="n">slater</span><span class="p">,</span>
    <span class="n">kemmeny_young</span><span class="p">,</span> 
    <span class="n">majority</span><span class="p">,</span> 
    <span class="n">bucklin</span><span class="p">,</span>
    <span class="n">simplified_bucklin</span><span class="p">,</span>
    <span class="n">weighted_bucklin</span>
<span class="p">]</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Wes Holliday and Eric Pacuit
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    </body>
</html>